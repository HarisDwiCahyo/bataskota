import{V as le,f as ce,M as fe,T,O as ve,X,L as he,a as we,G as ye,n as Q,b as ee,t as be,F as te,c as ae,S as O,d as b,e as C,g as Ee,h as Ce,i as ke,j as y,D as Ne,k as de,l as Le,C as oe,P as ne,m as Se,o as Be,p as me,q as Ge,r as Ie}from"./GeoJSON-C5wKpImO.js";import{c as Me}from"./main.esm-BcYrPVTO.js";import{G as ze}from"./Geolocation-DOMlNKP2.js";import{W as Pe}from"./WKT-BIzRGbMv.js";var G=new le({center:ce([110.35385111973005,-7.791739623962835]),zoom:18}),a=new fe({target:"map",view:G,controls:[]}),Te=new T({title:"Open Street Map",visible:!0,source:new ve}),Oe=new T({title:"Esri Maps",visible:!0,source:new X({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"})}),Fe=new T({title:"World Street Map",visible:!0,source:new X({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"})}),De=new T({title:"World Imagery Map",visible:!0,source:new X({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})}),He=new he({title:"BaseMaps",layers:[Oe,Te,Fe,De]});a.addLayer(He);const $e=new we({tipLabel:"Show Layers",groupSelectStyle:"children",collapseTipLabel:"Collapse layers"});a.addControl($e);$(document).ready(function(){let e=[];$("#formFile").on("change",function(t){je(t,e)}),$("#checkData").on("click",function(){We(e)})});function je(e,t){const o=e.target.files;if(o.length>0){const i=o[0];if(Ae(i)){const l=new FileReader;l.onload=function(n){Ve(n,t)},l.onerror=Re,l.readAsText(i)}else alert("Please upload a valid GeoJSON file.")}}function Ae(e){return e.type==="application/json"||e.name.endsWith(".geojson")}function Re(e){console.error("Error reading file:",e)}function Ve(e,t){try{const o=JSON.parse(e.target.result);console.log("GeoJSON data:",o),new ye().readFeatures(o).forEach(l=>{const n=xe(l);t.some(r=>r.kota===n.kota&&r.srsid===n.srsid&&r.kodekota===n.kodekota&&r.peraturan===n.peraturan&&r.batasutara===n.batasutara&&r.batastimur===n.batastimur&&r.batasselatan===n.batasselatan&&r.batasbarat===n.batasbarat&&r.beritaacara===n.beritaacara&&r.geom===n.geom)||t.push(n)}),Ze(t),Je(t)}catch(o){console.error("Error parsing GeoJSON file:",o)}}function xe(e){const t=new Pe;let o=e.getGeometry();function i(s){return Array.isArray(s)?s.map(r=>Array.isArray(r)?r.slice(0,2):r):s}if(o.getType()==="MultiPolygon"){const s=o.getPolygons();let r=[];s.forEach(E=>{E.getCoordinates().forEach(c=>{r.push(i(c))})}),o=new Q(r),e.setGeometry(o)}else if(o.getType()==="Polygon"){const s=o.getCoordinates().map(r=>i(r));o.setCoordinates(s)}let l=t.writeGeometry(o);l=l.replace(/POLYGON Z\(\(([^)]+)\)\)/g,(s,r)=>`POLYGON((${r.split(",").map(c=>c.trim().split(" ").slice(0,2).join(" ")).join(", ")}))`).replace(/MULTIPOLYGON Z\(\(\(([^)]+)\)\)\)/g,(s,r)=>r.split(")), ((").map(c=>`POLYGON((${c.split(",").map(W=>W.trim().split(" ").slice(0,2).join(" ")).join(", ")}))`).join(", "));const n=e.getProperties();return delete n.geometry,{kota:n.kota,srsid:n.srsid,kodekota:n.kodekota,peraturan:n.peraturan,batasutara:n.batasutara,batasbarat:n.batasbarat,batasselatan:n.batasselatan,batastimur:n.batastimur,beritaacara:n.beritaacara,geom:l}}let Z;function qe(e){const n=(e.length+8)*25+25,s={defaultColDef:{width:350,resizable:!0,filter:!0,floatingFilter:!0,sortable:!0},columnDefs:[{headerName:"Kota",field:"kota"},{headerName:"SRSID",field:"srsid"},{headerName:"Kode Kota",field:"kodekota"},{headerName:"Peraturan",field:"peraturan"},{headerName:"Batas Utara",field:"batasutara"},{headerName:"Batas Timur",field:"batastimur"},{headerName:"Batas Selatan",field:"batasselatan"},{headerName:"Batas Barat",field:"batasbarat"},{headerName:"Berita Acara",field:"beritaacara"},{headerName:"Geom",field:"geom"}],rowData:e,pagination:!0,paginationPageSize:10,rowSelection:"single"},r=document.querySelector("#myGrid");Z&&Z.destroy(),Z=new Me(r,s),r.style.height=n+"px"}function We(e){console.log("Displaying data: ",e),qe(e)}function Ze(e){const t=$("#featureForm");t.find("input[type='hidden']").remove();const o=$('meta[name="csrf-token"]').attr("content");t.append(S("_token",o));const i=$("#inputdate").val(),l=$("#operator").val();t.append(S("inputdate",i)),t.append(S("operator",l)),e.forEach(n=>{for(const s in n)t.append(S(`${s}[]`,n[s]))})}function S(e,t){return $("<input>").attr("type","hidden").attr("name",e).attr("value",t)}function Je(e){const t=new ee;t.clear(),e.forEach(l=>{const r=l.geom.substring(9,l.geom.length-1).split(",").map(c=>{const[q,W]=c.trim().split(" ").map(parseFloat);return[q,W]}).map(c=>be(c,"EPSG:4326","EPSG:3857")),E=new te({geometry:new Q([r]),kota:l.kota});t.addFeature(E)});const o=new ae({source:t,style:new O({fill:new b({color:"rgba(0, 0, 255, 0.1)"}),stroke:new C({color:"blue",width:2})})});a.addLayer(o);const i=t.getExtent();i&&!isNaN(i[0])&&!isNaN(i[1])&&!isNaN(i[2])&&!isNaN(i[3])?a.getView().fit(i,{padding:[50,50,50,50],duration:1e3}):console.warn("Extent is empty or invalid.")}var _e=new Ee({className:"mousePosition",projection:"EPSG:4326",coordinateFormat:function(e){return Ce(e,"{y} , {x}",6)}});a.addControl(_e);var Ye=new ke({target:"custom-scale-line",text:!0,bar:!0});a.addControl(Ye);var u=document.createElement("div");u.className="toolbarDiv";var N=document.createElement("button");N.innerHTML='<span class="icon"><i class="icon-home"></i></span>';N.className="myButton";N.title="Home";var F=document.createElement("div");F.className="homeButtonDiv";F.appendChild(N);u.appendChild(F);var Ke=new y({element:F});N.addEventListener("click",()=>{pe(),a.setView(new le({center:ce([110.35385111973005,-7.791739623962835]),zoom:18}))});a.addControl(Ke);let L=document.createElement("button");L.innerHTML='<span class="icon"><i class="icon-enlarge"></i></span>';L.className="myButton";L.title="FullScreen";var D=document.createElement("div");D.className="fsButtonDiv";D.appendChild(L);u.appendChild(D);let Ue=new y({element:D});L.addEventListener("click",()=>{let e=document.getElementById("map");e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullscreen?e.mozRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()});a.addControl(Ue);let g=document.createElement("button");g.innerHTML='<span class="icon"><i class="icon-hand"></i></span>';g.className="myButton";g.id="panButton";g.title="Pan";let H=document.createElement("div");H.className="panButtonDiv";H.appendChild(g);u.appendChild(H);let Xe=new y({element:H}),J=!1,re=new Ne;g.addEventListener("click",()=>{g.classList.toggle("clicked"),J=!J,J?(document.getElementById("map").style.cursor="grab",a.addInteraction(re)):(document.getElementById("map").style.cursor="default",a.removeInteraction(re))});a.addControl(Xe);var I=new de;I.on("boxend",function(){var e=I.getGeometry().getExtent();a.getView().fit(e)});var f=document.createElement("button");f.innerHTML='<span class="icon"><i class="icon-zoom-in"></i></span>';f.className="myButton";f.id="ziButton";f.title="ZoomIn";var j=document.createElement("div");j.className="ziButtonDiv";j.appendChild(f);u.appendChild(j);var Qe=new y({element:j}),_=!1;f.addEventListener("click",()=>{f.classList.toggle("clicked"),_=!_,_?(document.getElementById("map").style.cursor="zoom-in",a.addInteraction(I)):(a.removeInteraction(I),document.getElementById("map").style.cursor="default")});a.addControl(Qe);var M=new de;M.on("boxend",function(){var e=M.getGeometry().getExtent();a.getView().setCenter(Le(e)),G.setZoom(G.getZoom()-1)});var v=document.createElement("button");v.innerHTML='<span class="icon"><i class="icon-zoom-out"></i></span>';v.className="myButton";v.id="zoButton";v.title="Zoom Out";var A=document.createElement("div");A.className="zoButtonDiv";A.appendChild(v);u.appendChild(A);var et=new y({element:A}),Y=!1;v.addEventListener("click",()=>{v.classList.toggle("clicked"),Y=!Y,Y?(document.getElementById("map").style.cursor="zoom-out",a.addInteraction(M)):(a.removeInteraction(M),document.getElementById("map").style.cursor="default")});a.addControl(et);$("#btnCrosshair").on("click",function(e){$("#btnCrosshair").toggleClass("clicked"),$("#btnCrosshair").hasClass("clicked")?tt():pe()});var ue,B=new ze({trackingOptions:{enableHighAccuracy:!0},tracking:!0,projection:G.getProjection()}),k=new te;k.setStyle(new O({image:new oe({radius:6,fill:new b({color:"#3399cc"}),stroke:new C({color:"#fff",width:2})})}));var z=new te;new ae({map:a,source:new ee({features:[z,k]})});function tt(){var e=B.getPosition();k.setGeometry(e?new ne(e):null),z.setGeometry(B.getAccuracyGeometry()),e&&a.getView().animate({center:e,zoom:16,duration:1e3}),ue=setInterval(function(){var t=B.getPosition(),o=B.getAccuracyGeometry();k.setGeometry(t?new ne(t):null),z.setGeometry(o),t&&a.getView().animate({center:t,duration:1e3})},1e4)}function pe(){clearInterval(ue),k.setGeometry(null),z.setGeometry(null)}let h=document.createElement("button");h.innerHTML='<span class="icon"><i class="icon-ruler"></i></span>';h.className="myButton";h.id="lengthButton";h.title="Measure Length";var R=document.createElement("div");R.className="lengthButtonDiv";R.appendChild(h);u.appendChild(R);var at=new y({element:R}),K=!1;h.addEventListener("click",()=>{if(h.classList.toggle("clicked"),K=!K,document.getElementById("map").style.cursor="default",K)a.removeInteraction(m),ge("LineString");else{a.removeInteraction(m),x.clear();const e=document.getElementsByClassName("ol-tooltip ol-tooltip-static");for(;e.length>0;)e[0].remove()}});a.addControl(at);let w=document.createElement("button");w.innerHTML='<span class="icon"><i class="icon-straighten"></i></span>';w.className="myButton";w.id="areaButton";w.title="Measure Area";var V=document.createElement("div");V.className="areaButtonDiv";V.appendChild(w);u.appendChild(V);var ot=new y({element:V}),U=!1;w.addEventListener("click",()=>{if(w.classList.toggle("clicked"),U=!U,document.getElementById("map").style.cursor="default",U)a.removeInteraction(m),ge("Polygon");else{a.removeInteraction(m),x.clear();const e=document.getElementsByClassName("ol-tooltip ol-tooltip-static");for(;e.length>0;)e[0].remove()}});a.addControl(ot);var m,x=new ee,nt=new ae({source:x,style:new O({fill:new b({color:"rgba(255, 255, 255, 0.2)"}),stroke:new C({color:"#ffcc33",width:2}),image:new oe({radius:7,fill:new b({color:"#ffcc33"})})})});a.addLayer(nt);function ge(e){m=new Se({source:x,type:e,style:new O({fill:new b({color:"rgba(200, 200, 200, 0.6)"}),stroke:new C({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new oe({radius:5,stroke:new C({color:"rgba(0, 0, 0, 0.7)"}),fill:new b({color:"rgba(255, 255, 255, 0.2)"})})})}),a.addInteraction(m),ie(),rt();var t,o=function(i){i.dragging||t&&t.getGeometry()};a.on("pointermove",o),m.on("drawstart",function(i){t=i.feature;var l=i.coordinate;t.getGeometry().on("change",function(n){var s=n.target,r;s instanceof Q?(r=it(s),l=s.getInteriorPoint().getCoordinates()):s instanceof Be&&(r=st(s),l=s.getLastCoordinate()),d.innerHTML=r,P.setPosition(l)})}),m.on("drawend",function(){d.className="ol-tooltip ol-tooltip-static",P.setOffset([0,-7]),t=null,d=null,ie()})}var p,se;function rt(){p&&p.parentNode.removeChild(p),p=document.createElement("div"),p.className="ol-tooltip hidden",se=new me({element:p,offset:[15,0],positioning:"center-left"}),a.addOverlay(se)}$(a.getViewport()).on("mouseout",function(){$(p).addClass("hidden")});var d,P;function ie(){d&&d.parentNode.removeChild(d),d=document.createElement("div"),d.className="ol-tooltip  ol-tooltip-measure",P=new me({element:d,offset:[0,-15],positioning:"bottom-center"}),a.addOverlay(P)}var st=function(e){var t=Ge(e,{projection:"EPSG:3857"}),o;return t>1e3?o=Math.round(t/1e3*100)/100+" km":o=Math.round(t*100)/100+" m",o},it=function(e){var t=Ie(e,{projection:"EPSG:3857"}),o;return t>1e6?o=Math.round(t/1e6*100)/100+" km<sup>2</sup>":o=Math.round(t*100)/100+" m<sup>2</sup>",o};
