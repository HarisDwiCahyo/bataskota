import{V as ie,f as ce,M as fe,T as O,O as ve,X,L as we,a as he,G as ye,n as Q,b as ee,t as Ee,F as te,c as oe,S as A,d as E,e as M,g as Ce,h as Me,i as Ne,j as y,D as Se,k as de,l as De,C as ne,P as re,m as Ie,o as Le,p as me,q as Be,r as be}from"./GeoJSON-C5wKpImO.js";import{c as Ge}from"./main.esm-BcYrPVTO.js";import{G as Pe}from"./Geolocation-DOMlNKP2.js";import{W as ke}from"./WKT-BIzRGbMv.js";var B=new ie({center:ce([110.35385111973005,-7.791739623962835]),zoom:18}),o=new fe({target:"map",view:B,controls:[]}),Oe=new O({title:"Open Street Map",visible:!0,source:new ve}),Ae=new O({title:"Esri Maps",visible:!0,source:new X({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"})}),ze=new O({title:"World Street Map",visible:!0,source:new X({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"})}),Ke=new O({title:"World Imagery Map",visible:!0,source:new X({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})}),Fe=new we({title:"BaseMaps",layers:[Ae,Oe,ze,Ke]});o.addLayer(Fe);const Te=new he({tipLabel:"Show Layers",groupSelectStyle:"children",collapseTipLabel:"Collapse layers"});o.addControl(Te);$(document).ready(function(){let e=[];$("#formFile").on("change",function(t){We(t,e)}),$("#checkData").on("click",function(){je(e)})});function We(e,t){const n=e.target.files;if(n.length>0){const s=n[0];if(He(s)){const i=new FileReader;i.onload=function(a){$e(a,t)},i.onerror=Re,i.readAsText(s)}else alert("Please upload a valid GeoJSON file.")}}function He(e){return e.type==="application/json"||e.name.endsWith(".geojson")}function Re(e){console.error("Error reading file:",e)}function $e(e,t){try{const n=JSON.parse(e.target.result);console.log("GeoJSON data:",n),new ye().readFeatures(n).forEach(i=>{const a=xe(i);t.some(r=>r.NAMOBJ===a.NAMOBJ&&r.WADMKC===a.WADMKC&&r.WADMKK===a.WADMKK&&r.SRSID===a.SRSID&&r.KDCPUM===a.KDCPUM&&r.KDEPUM===a.KDEPUM&&r.geom===a.geom)||t.push(a)}),Ue(t),Ve(t)}catch(n){console.error("Error parsing GeoJSON file:",n)}}function xe(e){const t=new ke;let n=e.getGeometry();function s(l){return Array.isArray(l)?l.map(r=>Array.isArray(r)?r.slice(0,2):r):l}if(n.getType()==="MultiPolygon"){const l=n.getPolygons();let r=[];l.forEach(C=>{C.getCoordinates().forEach(c=>{r.push(s(c))})}),n=new Q(r),e.setGeometry(n)}else if(n.getType()==="Polygon"){const l=n.getCoordinates().map(r=>s(r));n.setCoordinates(l)}let i=t.writeGeometry(n);i=i.replace(/POLYGON Z\(\(([^)]+)\)\)/g,(l,r)=>`POLYGON((${r.split(",").map(c=>c.trim().split(" ").slice(0,2).join(" ")).join(", ")}))`).replace(/MULTIPOLYGON Z\(\(\(([^)]+)\)\)\)/g,(l,r)=>r.split(")), ((").map(c=>`POLYGON((${c.split(",").map(j=>j.trim().split(" ").slice(0,2).join(" ")).join(", ")}))`).join(", "));const a=e.getProperties();return delete a.geometry,{NAMOBJ:a.NAMOBJ,WADMKC:a.WADMKC,WADMKK:a.WADMKK,SRSID:a.SRS_ID,KDCPUM:a.KDCPUM,KDEPUM:a.KDEPUM,geom:i}}let U;function Je(e){const a=(e.length+8)*25+25,l={defaultColDef:{width:350,resizable:!0,filter:!0,floatingFilter:!0,sortable:!0},columnDefs:[{headerName:"NAMOBJ",field:"NAMOBJ"},{headerName:"WADMKC",field:"WADMKC"},{headerName:"WADMKK",field:"WADMKK"},{headerName:"SRSID",field:"SRSID"},{headerName:"KDCPUM",field:"KDCPUM"},{headerName:"KDEPUM",field:"KDEPUM"},{headerName:"Geom",field:"geom"}],rowData:e,pagination:!0,paginationPageSize:10,rowSelection:"single"},r=document.querySelector("#myGrid");U&&U.destroy(),U=new Ge(r,l),r.style.height=a+"px"}function je(e){console.log("Displaying data: ",e),Je(e)}function Ue(e){const t=$("#featureForm");t.find("input[type='hidden']").remove();const n=$('meta[name="csrf-token"]').attr("content");t.append(I("_token",n));const s=$("#inputdate").val(),i=$("#operator").val();t.append(I("inputdate",s)),t.append(I("operator",i)),e.forEach(a=>{for(const l in a)t.append(I(`${l}[]`,a[l]))})}function I(e,t){return $("<input>").attr("type","hidden").attr("name",e).attr("value",t)}function Ve(e){const t=new ee;t.clear(),e.forEach(i=>{const r=i.geom.substring(9,i.geom.length-1).split(",").map(c=>{const[J,j]=c.trim().split(" ").map(parseFloat);return[J,j]}).map(c=>Ee(c,"EPSG:4326","EPSG:3857")),C=new te({geometry:new Q([r]),NAMOBJ:i.NAMOBJ});t.addFeature(C)});const n=new oe({source:t,style:new A({fill:new E({color:"rgba(0, 0, 255, 0.1)"}),stroke:new M({color:"blue",width:2})})});o.addLayer(n);const s=t.getExtent();s&&!isNaN(s[0])&&!isNaN(s[1])&&!isNaN(s[2])&&!isNaN(s[3])?o.getView().fit(s,{padding:[50,50,50,50],duration:1e3}):console.warn("Extent is empty or invalid.")}var qe=new Ce({className:"mousePosition",projection:"EPSG:4326",coordinateFormat:function(e){return Me(e,"{y} , {x}",6)}});o.addControl(qe);var Ze=new Ne({target:"custom-scale-line",text:!0,bar:!0});o.addControl(Ze);var u=document.createElement("div");u.className="toolbarDiv";var S=document.createElement("button");S.innerHTML='<span class="icon"><i class="icon-home"></i></span>';S.className="myButton";S.title="Home";var z=document.createElement("div");z.className="homeButtonDiv";z.appendChild(S);u.appendChild(z);var _e=new y({element:z});S.addEventListener("click",()=>{pe(),o.setView(new ie({center:ce([110.35385111973005,-7.791739623962835]),zoom:18}))});o.addControl(_e);let D=document.createElement("button");D.innerHTML='<span class="icon"><i class="icon-enlarge"></i></span>';D.className="myButton";D.title="FullScreen";var K=document.createElement("div");K.className="fsButtonDiv";K.appendChild(D);u.appendChild(K);let Ye=new y({element:K});D.addEventListener("click",()=>{let e=document.getElementById("map");e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullscreen?e.mozRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()});o.addControl(Ye);let g=document.createElement("button");g.innerHTML='<span class="icon"><i class="icon-hand"></i></span>';g.className="myButton";g.id="panButton";g.title="Pan";let F=document.createElement("div");F.className="panButtonDiv";F.appendChild(g);u.appendChild(F);let Xe=new y({element:F}),V=!1,ae=new Se;g.addEventListener("click",()=>{g.classList.toggle("clicked"),V=!V,V?(document.getElementById("map").style.cursor="grab",o.addInteraction(ae)):(document.getElementById("map").style.cursor="default",o.removeInteraction(ae))});o.addControl(Xe);var b=new de;b.on("boxend",function(){var e=b.getGeometry().getExtent();o.getView().fit(e)});var f=document.createElement("button");f.innerHTML='<span class="icon"><i class="icon-zoom-in"></i></span>';f.className="myButton";f.id="ziButton";f.title="ZoomIn";var T=document.createElement("div");T.className="ziButtonDiv";T.appendChild(f);u.appendChild(T);var Qe=new y({element:T}),q=!1;f.addEventListener("click",()=>{f.classList.toggle("clicked"),q=!q,q?(document.getElementById("map").style.cursor="zoom-in",o.addInteraction(b)):(o.removeInteraction(b),document.getElementById("map").style.cursor="default")});o.addControl(Qe);var G=new de;G.on("boxend",function(){var e=G.getGeometry().getExtent();o.getView().setCenter(De(e)),B.setZoom(B.getZoom()-1)});var v=document.createElement("button");v.innerHTML='<span class="icon"><i class="icon-zoom-out"></i></span>';v.className="myButton";v.id="zoButton";v.title="Zoom Out";var W=document.createElement("div");W.className="zoButtonDiv";W.appendChild(v);u.appendChild(W);var et=new y({element:W}),Z=!1;v.addEventListener("click",()=>{v.classList.toggle("clicked"),Z=!Z,Z?(document.getElementById("map").style.cursor="zoom-out",o.addInteraction(G)):(o.removeInteraction(G),document.getElementById("map").style.cursor="default")});o.addControl(et);$("#btnCrosshair").on("click",function(e){$("#btnCrosshair").toggleClass("clicked"),$("#btnCrosshair").hasClass("clicked")?tt():pe()});var ue,L=new Pe({trackingOptions:{enableHighAccuracy:!0},tracking:!0,projection:B.getProjection()}),N=new te;N.setStyle(new A({image:new ne({radius:6,fill:new E({color:"#3399cc"}),stroke:new M({color:"#fff",width:2})})}));var P=new te;new oe({map:o,source:new ee({features:[P,N]})});function tt(){var e=L.getPosition();N.setGeometry(e?new re(e):null),P.setGeometry(L.getAccuracyGeometry()),e&&o.getView().animate({center:e,zoom:16,duration:1e3}),ue=setInterval(function(){var t=L.getPosition(),n=L.getAccuracyGeometry();N.setGeometry(t?new re(t):null),P.setGeometry(n),t&&o.getView().animate({center:t,duration:1e3})},1e4)}function pe(){clearInterval(ue),N.setGeometry(null),P.setGeometry(null)}let w=document.createElement("button");w.innerHTML='<span class="icon"><i class="icon-ruler"></i></span>';w.className="myButton";w.id="lengthButton";w.title="Measure Length";var H=document.createElement("div");H.className="lengthButtonDiv";H.appendChild(w);u.appendChild(H);var ot=new y({element:H}),_=!1;w.addEventListener("click",()=>{if(w.classList.toggle("clicked"),_=!_,document.getElementById("map").style.cursor="default",_)o.removeInteraction(m),ge("LineString");else{o.removeInteraction(m),x.clear();const e=document.getElementsByClassName("ol-tooltip ol-tooltip-static");for(;e.length>0;)e[0].remove()}});o.addControl(ot);let h=document.createElement("button");h.innerHTML='<span class="icon"><i class="icon-straighten"></i></span>';h.className="myButton";h.id="areaButton";h.title="Measure Area";var R=document.createElement("div");R.className="areaButtonDiv";R.appendChild(h);u.appendChild(R);var nt=new y({element:R}),Y=!1;h.addEventListener("click",()=>{if(h.classList.toggle("clicked"),Y=!Y,document.getElementById("map").style.cursor="default",Y)o.removeInteraction(m),ge("Polygon");else{o.removeInteraction(m),x.clear();const e=document.getElementsByClassName("ol-tooltip ol-tooltip-static");for(;e.length>0;)e[0].remove()}});o.addControl(nt);var m,x=new ee,rt=new oe({source:x,style:new A({fill:new E({color:"rgba(255, 255, 255, 0.2)"}),stroke:new M({color:"#ffcc33",width:2}),image:new ne({radius:7,fill:new E({color:"#ffcc33"})})})});o.addLayer(rt);function ge(e){m=new Ie({source:x,type:e,style:new A({fill:new E({color:"rgba(200, 200, 200, 0.6)"}),stroke:new M({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ne({radius:5,stroke:new M({color:"rgba(0, 0, 0, 0.7)"}),fill:new E({color:"rgba(255, 255, 255, 0.2)"})})})}),o.addInteraction(m),se(),at();var t,n=function(s){s.dragging||t&&t.getGeometry()};o.on("pointermove",n),m.on("drawstart",function(s){t=s.feature;var i=s.coordinate;t.getGeometry().on("change",function(a){var l=a.target,r;l instanceof Q?(r=st(l),i=l.getInteriorPoint().getCoordinates()):l instanceof Le&&(r=lt(l),i=l.getLastCoordinate()),d.innerHTML=r,k.setPosition(i)})}),m.on("drawend",function(){d.className="ol-tooltip ol-tooltip-static",k.setOffset([0,-7]),t=null,d=null,se()})}var p,le;function at(){p&&p.parentNode.removeChild(p),p=document.createElement("div"),p.className="ol-tooltip hidden",le=new me({element:p,offset:[15,0],positioning:"center-left"}),o.addOverlay(le)}$(o.getViewport()).on("mouseout",function(){$(p).addClass("hidden")});var d,k;function se(){d&&d.parentNode.removeChild(d),d=document.createElement("div"),d.className="ol-tooltip  ol-tooltip-measure",k=new me({element:d,offset:[0,-15],positioning:"bottom-center"}),o.addOverlay(k)}var lt=function(e){var t=Be(e,{projection:"EPSG:3857"}),n;return t>1e3?n=Math.round(t/1e3*100)/100+" km":n=Math.round(t*100)/100+" m",n},st=function(e){var t=be(e,{projection:"EPSG:3857"}),n;return t>1e6?n=Math.round(t/1e6*100)/100+" km<sup>2</sup>":n=Math.round(t*100)/100+" m<sup>2</sup>",n};
