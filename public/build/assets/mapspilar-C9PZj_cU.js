import{b as M,G as Y,c as Q,V as ce,f as de,M as ue,T as G,O as me,X as U,L as ne,S as v,C as N,d as u,e as d,a as pe,g as ve,h as fe,i as ge,j as C,D as ye,k as re,l as we,m as he,n as Ee,o as be,p as oe,q as Le,r as Se}from"./GeoJSON-C5wKpImO.js";document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".user-action");e.forEach(function(t){t.addEventListener("click",function(n){n.preventDefault();var o=document.querySelectorAll(".side-nav");o.forEach(function(i){i.classList.remove("active")});var r=t.getAttribute("data-target"),l=document.querySelector(r);l?l.classList.add("active"):console.error("Target sidebar not found for selector: ",r)})})});document.getElementById("layerSelect").addEventListener("change",function(){var e=this.value,t;if(e==="bataspilar")t="/admin/bataspilar";else if(e==="bataskota")t="/admin/kota";else if(e==="bataskemantren")t="/admin/kecamatan";else if(e==="bataskelurahan")t="/admin/kelurahan";else if(e==="batasrw")t="/admin/rw";else return;$.getJSON(t,function(n){if(n.data){var o=new M({features:new Y().readFeatures(n.data,{featureProjection:"EPSG:4326"})});Be(o)}else console.error("Data GeoJSON tidak ditemukan dalam respons")}).fail(function(n,o,r){console.error("Request Failed: "+o+", "+r)})});function Be(e){var t=e.getFeatures(),n=new Set;t.forEach(function(r){var l=r.getProperties();for(var i in l)l.hasOwnProperty(i)&&i!=="geometry"&&n.add(i)});var o=document.getElementById("propertySelect");o.innerHTML="<option>Pilih Properti</option>",n.forEach(function(r){var l=document.createElement("option");l.value=r,l.text=r,o.appendChild(l)}),o.addEventListener("change",function(){var r=this.value;Ie(r,t)})}function Ie(e,t){var n="";t.forEach(function(l){var i=l.getProperties();i.hasOwnProperty(e)&&n===""&&(typeof i[e]=="number"?n="number":n="string")});var o=document.getElementById("operatorSelect");o.innerHTML="<option>Pilih Operator</option>";var r=n==="number"?["=",">","<"]:["=","LIKE"];r.forEach(function(l){var i=document.createElement("option");i.value=l,i.text=l,o.appendChild(i)})}var R=null;document.getElementById("getFilterButton").addEventListener("click",function(){var e=document.getElementById("layerSelect").value,t=document.getElementById("propertySelect").value,n=document.getElementById("operatorSelect").value,o=document.getElementById("valueInput").value;if(e&&t&&n&&o){var r;if(e==="bataspilar")r="/admin/bataspilar";else if(e==="bataskota")r="/admin/kota";else if(e==="bataskemantren")r="/admin/kecamatan";else if(e==="bataskelurahan")r="/admin/kelurahan";else if(e==="batasrw")r="/admin/rw";else return;$.getJSON(r,function(l){if(l.data){let y=function(p){var P=p.getGeometry().getType();switch(P){case"Point":return new v({image:new N({radius:7,fill:new u({color:"rgba(255, 0, 0, 0.6)"}),stroke:new d({color:"red",width:2})})});case"LineString":return new v({stroke:new d({color:"red",width:3})});case"Polygon":return new v({stroke:new d({color:"red",width:2}),fill:new u({color:"rgba(0, 0, 255, 0.1)"})});default:return new v({stroke:new d({color:"black",width:1}),fill:new u({color:"rgba(0, 0, 0, 0.1)"})})}};var i=new M({features:new Y().readFeatures(l.data,{featureProjection:"EPSG:4326"})}),s=i.getFeatures().filter(function(p){var P=p.getProperties(),k=P[t];switch(n){case"=":return k==o;case">":return k>o;case"<":return k<o;case"LIKE":return k.toLowerCase().includes(o.toLowerCase());default:return!1}}),g=new M({features:s}),I=new Q({title:"Hasil Filter",source:g,style:y});R&&a.removeLayer(R),a.addLayer(I),R=I;var m=g.getExtent();a.getView().fit(m,{duration:1e3}),console.log(g),s.forEach(function(p){console.log(p.getProperties())})}else console.error("Data GeoJSON tidak ditemukan dalam respons")}).fail(function(l,i,s){console.error("Request Failed: "+i+", "+s)})}else alert("Silakan pilih semua opsi dan masukkan nilai.")});function le(){const e=document.querySelector(".card-body"),t=document.getElementById("attribute"),n=document.getElementById("map"),o=e.offsetHeight,r=t.offsetHeight,l=o-r;n.style.height=`${l>0?l:0}px`}function ke(){document.getElementById("attribute").classList.add("visible"),le()}const Ce=document.getElementById("attribute"),Pe=new ResizeObserver(e=>{for(let t of e)le()});Pe.observe(Ce);document.addEventListener("DOMContentLoaded",function(){ke()});var X=new ce({center:de([110.35385111973005,-7.791739623962835]),zoom:18,projection:"EPSG:4326"}),a=new ue({target:"map",view:X,controls:[]}),Me=new G({title:"Open Street Map",visible:!0,source:new me}),Ne=new G({title:"Esri Maps",visible:!0,source:new U({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"})}),Te=new G({title:"World Street Map",visible:!0,source:new U({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"})}),ze=new G({title:"World Imagery Map",visible:!0,source:new U({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})}),Fe=new ne({title:"BaseMaps",layers:[Ne,Me,Te,ze]});a.addLayer(Fe);var ie=new ne({title:"Group",layers:[]});a.addLayer(ie);$.getJSON("/admin/bataspilar",function(e){if(e.data){var t=new M({features:new Y().readFeatures(e.data,{featureProjection:"EPSG:4326"})}),n=new Q({title:"Pilar",source:t,style:new v({image:new N({radius:5,fill:new u({color:"blue"}),stroke:new d({color:"white",width:2})})})});ie.getLayers().push(n);var o=t.getExtent();a.getView().fit(o,{duration:1e3});var r=new v({image:new N({radius:7,fill:new u({color:"yellow"}),stroke:new d({color:"orange",width:2})})}),l=null;a.on("click",function(i){var s=null;if(a.forEachFeatureAtPixel(i.pixel,function(P,k){if(k===n)return s=P,!0}),s){l&&l.setStyle(null),s.setStyle(r),l=s;var g=s.getProperties(),I="<table class='table table-bordered m-0'><thead><tr><th>Property</th><th>Value</th></tr></thead><tbody>";for(var m in g)if(g.hasOwnProperty(m)&&m!=="geometry"){var y=g[m];if(m==="foto"){var p="/upload/foto/"+y;y="<a href='"+p+"' target='_blank'><img src='"+p+"' alt='Foto' style='width: 100px; height: auto;'/></a>"}else m==="beritaacara"&&(y="<a href='"+y+"' target='_blank'>link berita acara</a>");I+="<tr><td>"+m+"</td><td>"+y+"</td></tr>"}I+="</tbody></table>",document.querySelector("#attribute .card-body").innerHTML=I,document.getElementById("attribute").style.display="block"}else document.getElementById("attribute").style.display="none"})}else console.error("Data GeoJSON tidak ditemukan dalam respons")});const Oe=new pe({tipLabel:"Show Layers",groupSelectStyle:"children",collapseTipLabel:"Collapse layers"});a.addControl(Oe);var Ge=new ve({className:"mousePosition",projection:"EPSG:4326",coordinateFormat:function(e){return fe(e,"{y} , {x}",6)}});a.addControl(Ge);var xe=new ge({target:"custom-scale-line",text:!0,bar:!0});a.addControl(xe);var B=document.createElement("div");B.className="toolbarDiv";let T=document.createElement("button");T.innerHTML='<span class="icon"><i class="icon-enlarge"></i></span>';T.className="myButton";T.title="FullScreen";var x=document.createElement("div");x.className="fsButtonDiv";x.appendChild(T);B.appendChild(x);let De=new C({element:x});T.addEventListener("click",()=>{let e=document.getElementById("map");e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullscreen?e.mozRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()});a.addControl(De);let h=document.createElement("button");h.innerHTML='<span class="icon"><i class="icon-hand"></i></span>';h.className="myButton";h.id="panButton";h.title="Pan";let D=document.createElement("div");D.className="panButtonDiv";D.appendChild(h);B.appendChild(D);let qe=new C({element:D}),_=!1,ee=new ye;h.addEventListener("click",()=>{h.classList.toggle("clicked"),_=!_,_?(document.getElementById("map").style.cursor="grab",a.addInteraction(ee)):(document.getElementById("map").style.cursor="default",a.removeInteraction(ee))});a.addControl(qe);var z=new re;z.on("boxend",function(){var e=z.getGeometry().getExtent();a.getView().fit(e)});var E=document.createElement("button");E.innerHTML='<span class="icon"><i class="icon-zoom-in"></i></span>';E.className="myButton";E.id="ziButton";E.title="ZoomIn";var q=document.createElement("div");q.className="ziButtonDiv";q.appendChild(E);B.appendChild(q);var He=new C({element:q}),J=!1;E.addEventListener("click",()=>{E.classList.toggle("clicked"),J=!J,J?(document.getElementById("map").style.cursor="zoom-in",a.addInteraction(z)):(a.removeInteraction(z),document.getElementById("map").style.cursor="default")});a.addControl(He);var F=new re;F.on("boxend",function(){var e=F.getGeometry().getExtent();a.getView().setCenter(we(e)),X.setZoom(X.getZoom()-1)});var b=document.createElement("button");b.innerHTML='<span class="icon"><i class="icon-zoom-out"></i></span>';b.className="myButton";b.id="zoButton";b.title="Zoom Out";var H=document.createElement("div");H.className="zoButtonDiv";H.appendChild(b);B.appendChild(H);var Ae=new C({element:H}),W=!1;b.addEventListener("click",()=>{b.classList.toggle("clicked"),W=!W,W?(document.getElementById("map").style.cursor="zoom-out",a.addInteraction(F)):(a.removeInteraction(F),document.getElementById("map").style.cursor="default")});a.addControl(Ae);let L=document.createElement("button");L.innerHTML='<span class="icon"><i class="icon-ruler"></i></span>';L.className="myButton";L.id="lengthButton";L.title="Measure Length";var A=document.createElement("div");A.className="lengthButtonDiv";A.appendChild(L);B.appendChild(A);var je=new C({element:A}),Z=!1;L.addEventListener("click",()=>{if(L.classList.toggle("clicked"),Z=!Z,document.getElementById("map").style.cursor="default",Z)a.removeInteraction(f),se("LineString");else{a.removeInteraction(f),V.clear();const e=document.getElementsByClassName("ol-tooltip ol-tooltip-static");for(;e.length>0;)e[0].remove()}});a.addControl(je);let S=document.createElement("button");S.innerHTML='<span class="icon"><i class="icon-straighten"></i></span>';S.className="myButton";S.id="areaButton";S.title="Measure Area";var j=document.createElement("div");j.className="areaButtonDiv";j.appendChild(S);B.appendChild(j);var Ve=new C({element:j}),K=!1;S.addEventListener("click",()=>{if(S.classList.toggle("clicked"),K=!K,document.getElementById("map").style.cursor="default",K)a.removeInteraction(f),se("Polygon");else{a.removeInteraction(f),V.clear();const e=document.getElementsByClassName("ol-tooltip ol-tooltip-static");for(;e.length>0;)e[0].remove()}});a.addControl(Ve);var f,V=new M,Re=new Q({source:V,style:new v({fill:new u({color:"rgba(255, 255, 255, 0.2)"}),stroke:new d({color:"#ffcc33",width:2}),image:new N({radius:7,fill:new u({color:"#ffcc33"})})})});a.addLayer(Re);function se(e){f=new he({source:V,type:e,style:new v({fill:new u({color:"rgba(200, 200, 200, 0.6)"}),stroke:new d({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new N({radius:5,stroke:new d({color:"rgba(0, 0, 0, 0.7)"}),fill:new u({color:"rgba(255, 255, 255, 0.2)"})})})}),a.addInteraction(f),ae(),_e();var t,n=function(o){o.dragging||t&&t.getGeometry()};a.on("pointermove",n),f.on("drawstart",function(o){t=o.feature;var r=o.coordinate;t.getGeometry().on("change",function(l){var i=l.target,s;i instanceof Ee?(s=We(i),r=i.getInteriorPoint().getCoordinates()):i instanceof be&&(s=Je(i),r=i.getLastCoordinate()),c.innerHTML=s,O.setPosition(r)})}),f.on("drawend",function(){c.className="ol-tooltip ol-tooltip-static",O.setOffset([0,-7]),t=null,c=null,ae()})}var w,te;function _e(){w&&w.parentNode.removeChild(w),w=document.createElement("div"),w.className="ol-tooltip hidden",te=new oe({element:w,offset:[15,0],positioning:"center-left"}),a.addOverlay(te)}$(a.getViewport()).on("mouseout",function(){$(w).addClass("hidden")});var c,O;function ae(){c&&c.parentNode.removeChild(c),c=document.createElement("div"),c.className="ol-tooltip  ol-tooltip-measure",O=new oe({element:c,offset:[0,-15],positioning:"bottom-center"}),a.addOverlay(O)}var Je=function(e){var t=Le(e,{projection:"EPSG:4326"}),n;return t>1e3?n=Math.round(t/1e3*100)/100+" km":n=Math.round(t*100)/100+" m",n},We=function(e){var t=Se(e,{projection:"EPSG:4326"}),n;return t>1e6?n=Math.round(t/1e6*100)/100+" km<sup>2</sup>":n=Math.round(t*100)/100+" m<sup>2</sup>",n};
