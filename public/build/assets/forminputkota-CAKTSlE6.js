import{V as le,f as ce,M as fe,T as F,O as ve,X as U,L as we,a as ye,G as he,n as Q,b as ee,t as Ee,F as te,c as oe,S as z,d as E,e as S,g as Ce,h as Se,i as Ne,j as h,D as Be,k as de,l as Ie,C as ne,P as re,m as Le,o as be,p as me,q as Ge,r as Me}from"./GeoJSON-C5wKpImO.js";import{c as ke}from"./main.esm-BcYrPVTO.js";import{G as Oe}from"./Geolocation-DOMlNKP2.js";import{W as Pe}from"./WKT-BIzRGbMv.js";var G=new le({center:ce([110.35385111973005,-7.791739623962835]),zoom:18}),o=new fe({target:"map",view:G,controls:[]}),Fe=new F({title:"Open Street Map",visible:!0,source:new ve}),ze=new F({title:"Esri Maps",visible:!0,source:new U({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"})}),De=new F({title:"World Street Map",visible:!0,source:new U({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"})}),Te=new F({title:"World Imagery Map",visible:!0,source:new U({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})}),Ae=new we({title:"BaseMaps",layers:[ze,Fe,De,Te]});o.addLayer(Ae);const He=new ye({tipLabel:"Show Layers",groupSelectStyle:"children",collapseTipLabel:"Collapse layers"});o.addControl(He);$(document).ready(function(){let e=[];$("#formFile").on("change",function(t){xe(t,e)}),$("#checkData").on("click",function(){Ve(e)})});function xe(e,t){const n=e.target.files;if(n.length>0){const s=n[0];if(Re(s)){const i=new FileReader;i.onload=function(l){Je(l,t)},i.onerror=$e,i.readAsText(s)}else alert("Please upload a valid GeoJSON file.")}}function Re(e){return e.type==="application/json"||e.name.endsWith(".geojson")}function $e(e){console.error("Error reading file:",e)}function Je(e,t){try{const n=JSON.parse(e.target.result);console.log("GeoJSON data:",n),new he().readFeatures(n).forEach(i=>{const l=je(i);t.some(r=>r.NAMOBJ===l.NAMOBJ&&r.SRSID===l.SRSID&&r.KDPKAB===l.KDPKAB&&r.geom===l.geom)||t.push(l)}),qe(t),We(t)}catch(n){console.error("Error parsing GeoJSON file:",n)}}function je(e){const t=new Pe;let n=e.getGeometry();function s(a){return Array.isArray(a)?a.map(r=>Array.isArray(r)?r.slice(0,2):r):a}if(n.getType()==="MultiPolygon"){const a=n.getPolygons();let r=[];a.forEach(C=>{C.getCoordinates().forEach(c=>{r.push(s(c))})}),n=new Q(r),e.setGeometry(n)}else if(n.getType()==="Polygon"){const a=n.getCoordinates().map(r=>s(r));n.setCoordinates(a)}let i=t.writeGeometry(n);i=i.replace(/POLYGON Z\(\(([^)]+)\)\)/g,(a,r)=>`POLYGON((${r.split(",").map(c=>c.trim().split(" ").slice(0,2).join(" ")).join(", ")}))`).replace(/MULTIPOLYGON Z\(\(\(([^)]+)\)\)\)/g,(a,r)=>r.split(")), ((").map(c=>`POLYGON((${c.split(",").map(V=>V.trim().split(" ").slice(0,2).join(" ")).join(", ")}))`).join(", "));const l=e.getProperties();return delete l.geometry,{NAMOBJ:l.NAMOBJ,SRSID:l.SRS_ID,KDPKAB:l.KDPKAB,geom:i}}let q;function Ke(e){const l=(e.length+8)*25+25,a={defaultColDef:{width:350,resizable:!0,filter:!0,floatingFilter:!0,sortable:!0},columnDefs:[{headerName:"NAMOBJ",field:"NAMOBJ"},{headerName:"SRSID",field:"SRSID"},{headerName:"KDPKAB",field:"KDPKAB"},{headerName:"Geom",field:"geom"}],rowData:e,pagination:!0,paginationPageSize:10,rowSelection:"single"},r=document.querySelector("#myGrid");q&&q.destroy(),q=new ke(r,a),r.style.height=l+"px"}function Ve(e){console.log("Displaying data: ",e),Ke(e)}function qe(e){const t=$("#featureForm");t.find("input[type='hidden']").remove();const n=$('meta[name="csrf-token"]').attr("content");t.append(L("_token",n));const s=$("#inputdate").val(),i=$("#operator").val();t.append(L("inputdate",s)),t.append(L("operator",i)),e.forEach(l=>{for(const a in l)t.append(L(`${a}[]`,l[a]))})}function L(e,t){return $("<input>").attr("type","hidden").attr("name",e).attr("value",t)}function We(e){const t=new ee;t.clear(),e.forEach(i=>{const r=i.geom.substring(9,i.geom.length-1).split(",").map(c=>{const[K,V]=c.trim().split(" ").map(parseFloat);return[K,V]}).map(c=>Ee(c,"EPSG:4326","EPSG:3857")),C=new te({geometry:new Q([r]),NAMOBJ:i.NAMOBJ});t.addFeature(C)});const n=new oe({source:t,style:new z({fill:new E({color:"rgba(0, 0, 255, 0.1)"}),stroke:new S({color:"blue",width:2})})});o.addLayer(n);const s=t.getExtent();s&&!isNaN(s[0])&&!isNaN(s[1])&&!isNaN(s[2])&&!isNaN(s[3])?o.getView().fit(s,{padding:[50,50,50,50],duration:1e3}):console.warn("Extent is empty or invalid.")}var Ze=new Ce({className:"mousePosition",projection:"EPSG:4326",coordinateFormat:function(e){return Se(e,"{y} , {x}",6)}});o.addControl(Ze);var _e=new Ne({target:"custom-scale-line",text:!0,bar:!0});o.addControl(_e);var u=document.createElement("div");u.className="toolbarDiv";var B=document.createElement("button");B.innerHTML='<span class="icon"><i class="icon-home"></i></span>';B.className="myButton";B.title="Home";var D=document.createElement("div");D.className="homeButtonDiv";D.appendChild(B);u.appendChild(D);var Ye=new h({element:D});B.addEventListener("click",()=>{pe(),o.setView(new le({center:ce([110.35385111973005,-7.791739623962835]),zoom:18}))});o.addControl(Ye);let I=document.createElement("button");I.innerHTML='<span class="icon"><i class="icon-enlarge"></i></span>';I.className="myButton";I.title="FullScreen";var T=document.createElement("div");T.className="fsButtonDiv";T.appendChild(I);u.appendChild(T);let Xe=new h({element:T});I.addEventListener("click",()=>{let e=document.getElementById("map");e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullscreen?e.mozRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()});o.addControl(Xe);let g=document.createElement("button");g.innerHTML='<span class="icon"><i class="icon-hand"></i></span>';g.className="myButton";g.id="panButton";g.title="Pan";let A=document.createElement("div");A.className="panButtonDiv";A.appendChild(g);u.appendChild(A);let Ue=new h({element:A}),W=!1,ae=new Be;g.addEventListener("click",()=>{g.classList.toggle("clicked"),W=!W,W?(document.getElementById("map").style.cursor="grab",o.addInteraction(ae)):(document.getElementById("map").style.cursor="default",o.removeInteraction(ae))});o.addControl(Ue);var M=new de;M.on("boxend",function(){var e=M.getGeometry().getExtent();o.getView().fit(e)});var f=document.createElement("button");f.innerHTML='<span class="icon"><i class="icon-zoom-in"></i></span>';f.className="myButton";f.id="ziButton";f.title="ZoomIn";var H=document.createElement("div");H.className="ziButtonDiv";H.appendChild(f);u.appendChild(H);var Qe=new h({element:H}),Z=!1;f.addEventListener("click",()=>{f.classList.toggle("clicked"),Z=!Z,Z?(document.getElementById("map").style.cursor="zoom-in",o.addInteraction(M)):(o.removeInteraction(M),document.getElementById("map").style.cursor="default")});o.addControl(Qe);var k=new de;k.on("boxend",function(){var e=k.getGeometry().getExtent();o.getView().setCenter(Ie(e)),G.setZoom(G.getZoom()-1)});var v=document.createElement("button");v.innerHTML='<span class="icon"><i class="icon-zoom-out"></i></span>';v.className="myButton";v.id="zoButton";v.title="Zoom Out";var x=document.createElement("div");x.className="zoButtonDiv";x.appendChild(v);u.appendChild(x);var et=new h({element:x}),_=!1;v.addEventListener("click",()=>{v.classList.toggle("clicked"),_=!_,_?(document.getElementById("map").style.cursor="zoom-out",o.addInteraction(k)):(o.removeInteraction(k),document.getElementById("map").style.cursor="default")});o.addControl(et);$("#btnCrosshair").on("click",function(e){$("#btnCrosshair").toggleClass("clicked"),$("#btnCrosshair").hasClass("clicked")?tt():pe()});var ue,b=new Oe({trackingOptions:{enableHighAccuracy:!0},tracking:!0,projection:G.getProjection()}),N=new te;N.setStyle(new z({image:new ne({radius:6,fill:new E({color:"#3399cc"}),stroke:new S({color:"#fff",width:2})})}));var O=new te;new oe({map:o,source:new ee({features:[O,N]})});function tt(){var e=b.getPosition();N.setGeometry(e?new re(e):null),O.setGeometry(b.getAccuracyGeometry()),e&&o.getView().animate({center:e,zoom:16,duration:1e3}),ue=setInterval(function(){var t=b.getPosition(),n=b.getAccuracyGeometry();N.setGeometry(t?new re(t):null),O.setGeometry(n),t&&o.getView().animate({center:t,duration:1e3})},1e4)}function pe(){clearInterval(ue),N.setGeometry(null),O.setGeometry(null)}let w=document.createElement("button");w.innerHTML='<span class="icon"><i class="icon-ruler"></i></span>';w.className="myButton";w.id="lengthButton";w.title="Measure Length";var R=document.createElement("div");R.className="lengthButtonDiv";R.appendChild(w);u.appendChild(R);var ot=new h({element:R}),Y=!1;w.addEventListener("click",()=>{if(w.classList.toggle("clicked"),Y=!Y,document.getElementById("map").style.cursor="default",Y)o.removeInteraction(m),ge("LineString");else{o.removeInteraction(m),j.clear();const e=document.getElementsByClassName("ol-tooltip ol-tooltip-static");for(;e.length>0;)e[0].remove()}});o.addControl(ot);let y=document.createElement("button");y.innerHTML='<span class="icon"><i class="icon-straighten"></i></span>';y.className="myButton";y.id="areaButton";y.title="Measure Area";var J=document.createElement("div");J.className="areaButtonDiv";J.appendChild(y);u.appendChild(J);var nt=new h({element:J}),X=!1;y.addEventListener("click",()=>{if(y.classList.toggle("clicked"),X=!X,document.getElementById("map").style.cursor="default",X)o.removeInteraction(m),ge("Polygon");else{o.removeInteraction(m),j.clear();const e=document.getElementsByClassName("ol-tooltip ol-tooltip-static");for(;e.length>0;)e[0].remove()}});o.addControl(nt);var m,j=new ee,rt=new oe({source:j,style:new z({fill:new E({color:"rgba(255, 255, 255, 0.2)"}),stroke:new S({color:"#ffcc33",width:2}),image:new ne({radius:7,fill:new E({color:"#ffcc33"})})})});o.addLayer(rt);function ge(e){m=new Le({source:j,type:e,style:new z({fill:new E({color:"rgba(200, 200, 200, 0.6)"}),stroke:new S({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ne({radius:5,stroke:new S({color:"rgba(0, 0, 0, 0.7)"}),fill:new E({color:"rgba(255, 255, 255, 0.2)"})})})}),o.addInteraction(m),ie(),at();var t,n=function(s){s.dragging||t&&t.getGeometry()};o.on("pointermove",n),m.on("drawstart",function(s){t=s.feature;var i=s.coordinate;t.getGeometry().on("change",function(l){var a=l.target,r;a instanceof Q?(r=it(a),i=a.getInteriorPoint().getCoordinates()):a instanceof be&&(r=st(a),i=a.getLastCoordinate()),d.innerHTML=r,P.setPosition(i)})}),m.on("drawend",function(){d.className="ol-tooltip ol-tooltip-static",P.setOffset([0,-7]),t=null,d=null,ie()})}var p,se;function at(){p&&p.parentNode.removeChild(p),p=document.createElement("div"),p.className="ol-tooltip hidden",se=new me({element:p,offset:[15,0],positioning:"center-left"}),o.addOverlay(se)}$(o.getViewport()).on("mouseout",function(){$(p).addClass("hidden")});var d,P;function ie(){d&&d.parentNode.removeChild(d),d=document.createElement("div"),d.className="ol-tooltip  ol-tooltip-measure",P=new me({element:d,offset:[0,-15],positioning:"bottom-center"}),o.addOverlay(P)}var st=function(e){var t=Ge(e,{projection:"EPSG:3857"}),n;return t>1e3?n=Math.round(t/1e3*100)/100+" km":n=Math.round(t*100)/100+" m",n},it=function(e){var t=Me(e,{projection:"EPSG:3857"}),n;return t>1e6?n=Math.round(t/1e6*100)/100+" km<sup>2</sup>":n=Math.round(t*100)/100+" m<sup>2</sup>",n};
