import{V as le,f as ce,M as fe,T as O,O as ve,X,L as we,a as ye,G as he,n as Q,b as ee,t as Ee,F as te,c as oe,S as F,d as E,e as S,g as Ce,h as Se,i as Ne,j as h,D as Me,k as de,l as Ie,C as ne,P as re,m as Le,o as Be,p as me,q as be,r as Ge}from"./GeoJSON-C5wKpImO.js";import{c as De}from"./main.esm-BcYrPVTO.js";import{G as ke}from"./Geolocation-DOMlNKP2.js";import{W as Pe}from"./WKT-BIzRGbMv.js";var b=new le({center:ce([110.35385111973005,-7.791739623962835]),zoom:18}),o=new fe({target:"map",view:b,controls:[]}),Oe=new O({title:"Open Street Map",visible:!0,source:new ve}),Fe=new O({title:"Esri Maps",visible:!0,source:new X({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"})}),ze=new O({title:"World Street Map",visible:!0,source:new X({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"})}),Te=new O({title:"World Imagery Map",visible:!0,source:new X({attributions:["Tiles © Esri"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})}),Ae=new we({title:"BaseMaps",layers:[Fe,Oe,ze,Te]});o.addLayer(Ae);const Ke=new ye({tipLabel:"Show Layers",groupSelectStyle:"children",collapseTipLabel:"Collapse layers"});o.addControl(Ke);$(document).ready(function(){let e=[];$("#formFile").on("change",function(t){He(t,e)}),$("#checkData").on("click",function(){je(e)})});function He(e,t){const n=e.target.files;if(n.length>0){const i=n[0];if(Re(i)){const l=new FileReader;l.onload=function(s){We(s,t)},l.onerror=xe,l.readAsText(i)}else alert("Please upload a valid GeoJSON file.")}}function Re(e){return e.type==="application/json"||e.name.endsWith(".geojson")}function xe(e){console.error("Error reading file:",e)}function We(e,t){try{const n=JSON.parse(e.target.result);console.log("GeoJSON data:",n),new he().readFeatures(n).forEach(l=>{const s=$e(l);t.some(r=>r.NAMOBJ===s.NAMOBJ&&r.WADMKK===s.WADMKK&&r.SRSID===s.SRSID&&r.KDCPUM===s.KDCPUM&&r.geom===s.geom)||t.push(s)}),Ve(t),qe(t)}catch(n){console.error("Error parsing GeoJSON file:",n)}}function $e(e){const t=new Pe;let n=e.getGeometry();function i(a){return Array.isArray(a)?a.map(r=>Array.isArray(r)?r.slice(0,2):r):a}if(n.getType()==="MultiPolygon"){const a=n.getPolygons();let r=[];a.forEach(C=>{C.getCoordinates().forEach(c=>{r.push(i(c))})}),n=new Q(r),e.setGeometry(n)}else if(n.getType()==="Polygon"){const a=n.getCoordinates().map(r=>i(r));n.setCoordinates(a)}let l=t.writeGeometry(n);l=l.replace(/POLYGON Z\(\(([^)]+)\)\)/g,(a,r)=>`POLYGON((${r.split(",").map(c=>c.trim().split(" ").slice(0,2).join(" ")).join(", ")}))`).replace(/MULTIPOLYGON Z\(\(\(([^)]+)\)\)\)/g,(a,r)=>r.split(")), ((").map(c=>`POLYGON((${c.split(",").map(j=>j.trim().split(" ").slice(0,2).join(" ")).join(", ")}))`).join(", "));const s=e.getProperties();return delete s.geometry,{NAMOBJ:s.NAMOBJ,WADMKK:s.WADMKK,SRSID:s.SRS_ID,KDCPUM:s.KDCPUM,geom:l}}let V;function Je(e){const s=(e.length+8)*25+25,a={defaultColDef:{width:350,resizable:!0,filter:!0,floatingFilter:!0,sortable:!0},columnDefs:[{headerName:"NAMOBJ",field:"NAMOBJ"},{headerName:"WADMKK",field:"WADMKK"},{headerName:"SRSID",field:"SRSID"},{headerName:"KDCPUM",field:"KDCPUM"},{headerName:"Geom",field:"geom"}],rowData:e,pagination:!0,paginationPageSize:10,rowSelection:"single"},r=document.querySelector("#myGrid");V&&V.destroy(),V=new De(r,a),r.style.height=s+"px"}function je(e){console.log("Displaying data: ",e),Je(e)}function Ve(e){const t=$("#featureForm");t.find("input[type='hidden']").remove();const n=$('meta[name="csrf-token"]').attr("content");t.append(L("_token",n));const i=$("#inputdate").val(),l=$("#operator").val();t.append(L("inputdate",i)),t.append(L("operator",l)),e.forEach(s=>{for(const a in s)t.append(L(`${a}[]`,s[a]))})}function L(e,t){return $("<input>").attr("type","hidden").attr("name",e).attr("value",t)}function qe(e){const t=new ee;t.clear(),e.forEach(l=>{const r=l.geom.substring(9,l.geom.length-1).split(",").map(c=>{const[J,j]=c.trim().split(" ").map(parseFloat);return[J,j]}).map(c=>Ee(c,"EPSG:4326","EPSG:3857")),C=new te({geometry:new Q([r]),NAMOBJ:l.NAMOBJ,KDCPUM:l.KDCPUM});t.addFeature(C)});const n=new oe({source:t,style:new F({fill:new E({color:"rgba(0, 0, 255, 0.1)"}),stroke:new S({color:"blue",width:2})})});o.addLayer(n);const i=t.getExtent();i&&!isNaN(i[0])&&!isNaN(i[1])&&!isNaN(i[2])&&!isNaN(i[3])?o.getView().fit(i,{padding:[50,50,50,50],duration:1e3}):console.warn("Extent is empty or invalid.")}var Ue=new Ce({className:"mousePosition",projection:"EPSG:4326",coordinateFormat:function(e){return Se(e,"{y} , {x}",6)}});o.addControl(Ue);var Ze=new Ne({target:"custom-scale-line",text:!0,bar:!0});o.addControl(Ze);var u=document.createElement("div");u.className="toolbarDiv";var M=document.createElement("button");M.innerHTML='<span class="icon"><i class="icon-home"></i></span>';M.className="myButton";M.title="Home";var z=document.createElement("div");z.className="homeButtonDiv";z.appendChild(M);u.appendChild(z);var _e=new h({element:z});M.addEventListener("click",()=>{pe(),o.setView(new le({center:ce([110.35385111973005,-7.791739623962835]),zoom:18}))});o.addControl(_e);let I=document.createElement("button");I.innerHTML='<span class="icon"><i class="icon-enlarge"></i></span>';I.className="myButton";I.title="FullScreen";var T=document.createElement("div");T.className="fsButtonDiv";T.appendChild(I);u.appendChild(T);let Ye=new h({element:T});I.addEventListener("click",()=>{let e=document.getElementById("map");e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullscreen?e.mozRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()});o.addControl(Ye);let g=document.createElement("button");g.innerHTML='<span class="icon"><i class="icon-hand"></i></span>';g.className="myButton";g.id="panButton";g.title="Pan";let A=document.createElement("div");A.className="panButtonDiv";A.appendChild(g);u.appendChild(A);let Xe=new h({element:A}),q=!1,ae=new Me;g.addEventListener("click",()=>{g.classList.toggle("clicked"),q=!q,q?(document.getElementById("map").style.cursor="grab",o.addInteraction(ae)):(document.getElementById("map").style.cursor="default",o.removeInteraction(ae))});o.addControl(Xe);var G=new de;G.on("boxend",function(){var e=G.getGeometry().getExtent();o.getView().fit(e)});var f=document.createElement("button");f.innerHTML='<span class="icon"><i class="icon-zoom-in"></i></span>';f.className="myButton";f.id="ziButton";f.title="ZoomIn";var K=document.createElement("div");K.className="ziButtonDiv";K.appendChild(f);u.appendChild(K);var Qe=new h({element:K}),U=!1;f.addEventListener("click",()=>{f.classList.toggle("clicked"),U=!U,U?(document.getElementById("map").style.cursor="zoom-in",o.addInteraction(G)):(o.removeInteraction(G),document.getElementById("map").style.cursor="default")});o.addControl(Qe);var D=new de;D.on("boxend",function(){var e=D.getGeometry().getExtent();o.getView().setCenter(Ie(e)),b.setZoom(b.getZoom()-1)});var v=document.createElement("button");v.innerHTML='<span class="icon"><i class="icon-zoom-out"></i></span>';v.className="myButton";v.id="zoButton";v.title="Zoom Out";var H=document.createElement("div");H.className="zoButtonDiv";H.appendChild(v);u.appendChild(H);var et=new h({element:H}),Z=!1;v.addEventListener("click",()=>{v.classList.toggle("clicked"),Z=!Z,Z?(document.getElementById("map").style.cursor="zoom-out",o.addInteraction(D)):(o.removeInteraction(D),document.getElementById("map").style.cursor="default")});o.addControl(et);$("#btnCrosshair").on("click",function(e){$("#btnCrosshair").toggleClass("clicked"),$("#btnCrosshair").hasClass("clicked")?tt():pe()});var ue,B=new ke({trackingOptions:{enableHighAccuracy:!0},tracking:!0,projection:b.getProjection()}),N=new te;N.setStyle(new F({image:new ne({radius:6,fill:new E({color:"#3399cc"}),stroke:new S({color:"#fff",width:2})})}));var k=new te;new oe({map:o,source:new ee({features:[k,N]})});function tt(){var e=B.getPosition();N.setGeometry(e?new re(e):null),k.setGeometry(B.getAccuracyGeometry()),e&&o.getView().animate({center:e,zoom:16,duration:1e3}),ue=setInterval(function(){var t=B.getPosition(),n=B.getAccuracyGeometry();N.setGeometry(t?new re(t):null),k.setGeometry(n),t&&o.getView().animate({center:t,duration:1e3})},1e4)}function pe(){clearInterval(ue),N.setGeometry(null),k.setGeometry(null)}let w=document.createElement("button");w.innerHTML='<span class="icon"><i class="icon-ruler"></i></span>';w.className="myButton";w.id="lengthButton";w.title="Measure Length";var R=document.createElement("div");R.className="lengthButtonDiv";R.appendChild(w);u.appendChild(R);var ot=new h({element:R}),_=!1;w.addEventListener("click",()=>{if(w.classList.toggle("clicked"),_=!_,document.getElementById("map").style.cursor="default",_)o.removeInteraction(m),ge("LineString");else{o.removeInteraction(m),W.clear();const e=document.getElementsByClassName("ol-tooltip ol-tooltip-static");for(;e.length>0;)e[0].remove()}});o.addControl(ot);let y=document.createElement("button");y.innerHTML='<span class="icon"><i class="icon-straighten"></i></span>';y.className="myButton";y.id="areaButton";y.title="Measure Area";var x=document.createElement("div");x.className="areaButtonDiv";x.appendChild(y);u.appendChild(x);var nt=new h({element:x}),Y=!1;y.addEventListener("click",()=>{if(y.classList.toggle("clicked"),Y=!Y,document.getElementById("map").style.cursor="default",Y)o.removeInteraction(m),ge("Polygon");else{o.removeInteraction(m),W.clear();const e=document.getElementsByClassName("ol-tooltip ol-tooltip-static");for(;e.length>0;)e[0].remove()}});o.addControl(nt);var m,W=new ee,rt=new oe({source:W,style:new F({fill:new E({color:"rgba(255, 255, 255, 0.2)"}),stroke:new S({color:"#ffcc33",width:2}),image:new ne({radius:7,fill:new E({color:"#ffcc33"})})})});o.addLayer(rt);function ge(e){m=new Le({source:W,type:e,style:new F({fill:new E({color:"rgba(200, 200, 200, 0.6)"}),stroke:new S({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ne({radius:5,stroke:new S({color:"rgba(0, 0, 0, 0.7)"}),fill:new E({color:"rgba(255, 255, 255, 0.2)"})})})}),o.addInteraction(m),ie(),at();var t,n=function(i){i.dragging||t&&t.getGeometry()};o.on("pointermove",n),m.on("drawstart",function(i){t=i.feature;var l=i.coordinate;t.getGeometry().on("change",function(s){var a=s.target,r;a instanceof Q?(r=it(a),l=a.getInteriorPoint().getCoordinates()):a instanceof Be&&(r=st(a),l=a.getLastCoordinate()),d.innerHTML=r,P.setPosition(l)})}),m.on("drawend",function(){d.className="ol-tooltip ol-tooltip-static",P.setOffset([0,-7]),t=null,d=null,ie()})}var p,se;function at(){p&&p.parentNode.removeChild(p),p=document.createElement("div"),p.className="ol-tooltip hidden",se=new me({element:p,offset:[15,0],positioning:"center-left"}),o.addOverlay(se)}$(o.getViewport()).on("mouseout",function(){$(p).addClass("hidden")});var d,P;function ie(){d&&d.parentNode.removeChild(d),d=document.createElement("div"),d.className="ol-tooltip  ol-tooltip-measure",P=new me({element:d,offset:[0,-15],positioning:"bottom-center"}),o.addOverlay(P)}var st=function(e){var t=be(e,{projection:"EPSG:3857"}),n;return t>1e3?n=Math.round(t/1e3*100)/100+" km":n=Math.round(t*100)/100+" m",n},it=function(e){var t=Ge(e,{projection:"EPSG:3857"}),n;return t>1e6?n=Math.round(t/1e6*100)/100+" km<sup>2</sup>":n=Math.round(t*100)/100+" m<sup>2</sup>",n};
